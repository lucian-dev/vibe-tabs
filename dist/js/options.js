(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t,o){chrome.runtime.sendMessage({type:"showNotification",title:e,message:t,url:o},(function(e){chrome.runtime.lastError?console.error("Message error:",chrome.runtime.lastError):console.log("Message sent:",e)}))}function o(e,t){t.innerHTML="",e.forEach((function(e,o){var n=document.createElement("li");n.innerHTML="\n        <span>".concat(e,'</span>\n        <div class="action-buttons">\n          <button class="edit-button" data-index="').concat(o,'">Edit</button>\n          <button class="delete-button" data-index="').concat(o,'">Delete</button>\n        </div>\n      '),t.appendChild(n)}))}document.addEventListener("DOMContentLoaded",(function(){var n=document.getElementById("createNewMood"),i=document.getElementById("deactivateMood"),c=document.getElementById("editMoodModal"),s=document.getElementById("closeModal"),r=document.getElementById("editMoodForm"),a=document.getElementById("moodId"),d=document.getElementById("editMoodName"),l=document.getElementById("editMusicUrl"),u=document.getElementById("editTabUrl"),m=document.getElementById("tabUrlError"),f=document.getElementById("addTabButton"),v=document.getElementById("editTabsList"),p=[],h=null;function y(){chrome.storage.local.get(["moods","activeMoodIndex"],(function(o){var n=o.moods||[],c=o.activeMoodIndex;i.style.display=void 0!==c?"block":"none",function(e,t,o,n,i,c){var s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(t.innerHTML="",0===e.length){var r=document.createElement("div");return r.className="no-moods-message",r.innerHTML='\n      <p>No moods created yet.</p>\n      <p>Click "Create New Mood" to get started!</p>\n    ',void t.appendChild(r)}e.forEach((function(r,a){var d=document.createElement("div");d.className="mood-item",a===c&&d.classList.add("active-mood"),d.innerHTML="\n      <span>".concat(r.name,'</span>\n      <div class="action-buttons">\n        ').concat(a===c?"<span>Active Mood</span>":s?'\n            <button class="edit-button" data-index="'.concat(a,'">Edit</button>\n            <button class="delete-button" data-index="').concat(a,'">Delete</button>\n          '):"<span>Not active</span>","\n      </div>\n    "),d.addEventListener("click",(function(){i&&i(a,e)})),s&&a!==c&&(d.querySelector(".edit-button").addEventListener("click",(function(t){t.stopPropagation(),o&&o(a,e)})),d.querySelector(".delete-button").addEventListener("click",(function(t){t.stopPropagation(),n&&n(a,e)}))),t.appendChild(d)}))}(n,document.getElementById("moodList"),g,(function(e,o){return function(e,o,n){if(o&&o[e]){if(confirm("Are you sure you want to delete this mood?")){var i=o.splice(e,1)[0];chrome.storage.local.set({moods:o},(function(){t("Mood Deleted","".concat(i.name," mood deleted!"),chrome.runtime.getURL("src/options/options.html")),n&&n(),chrome.runtime.sendMessage({type:"refreshMoods"})}))}}else console.error("Moods array is undefined or index is out of bounds")}(e,o,y)}),(function(o,n){return function(o,n,i){if(n&&n[o]){var c=n[o],s=[];chrome.storage.local.get("activeMoodIndex",(function(n){n.activeMoodIndex!==o?(chrome.storage.local.set({activeMoodIndex:o},(function(){console.log("Active mood index set to ".concat(o))})),chrome.tabs.query({active:!0,currentWindow:!0},(function(o){var n=o[0],r=n.id;chrome.tabs.query({currentWindow:!0},(function(o){var a=o.filter((function(e){return e.id!==n.id})).map((function(e){return e.id}));chrome.tabs.remove(a,(function(){c.tabs.forEach((function(t,o){var n="object"===e(t)?t.url:t;chrome.tabs.create({url:n,active:0===o},(function(e){s.push(e.id)}))})),c.music&&chrome.tabs.create({url:c.music,pinned:!0}),chrome.tabs.update(r,{active:!0}),t("Mood Activated","".concat(c.name," mood activated!"),chrome.runtime.getURL("src/options/options.html")),i&&i(),chrome.runtime.sendMessage({type:"refreshMoods"})}))}))}))):t("Mood Already Active","".concat(c.name," mood is already active!"),chrome.runtime.getURL("src/options/options.html"))}))}else console.error("Moods array is undefined or index is out of bounds")}(o,n,y)}),c,!0)}))}function g(e){h=e;var t=null!==e?(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[])[e]:{name:"",tabs:[],music:""};a.value=null!==e?t.id:"",d.value=t.name,l.value=t.music||"",o(p=t.tabs||[],v),c.style.display="block"}y(),n.addEventListener("click",(function(){window.location.href=chrome.runtime.getURL("src/welcome/welcome.html")})),i.addEventListener("click",(function(){var e;e=function(){y()},chrome.storage.local.get("activeMoodIndex",(function(o){void 0!==o.activeMoodIndex?chrome.storage.local.remove("activeMoodIndex",(function(){console.log("Active mood deactivated!"),chrome.tabs.query({currentWindow:!0},(function(o){var n=o.find((function(e){return e.active})),i=o.filter((function(e){return e.id!==n.id})).map((function(e){return e.id}));chrome.tabs.remove(i,(function(){t("Mood Deactivated","No mood is currently active!",chrome.runtime.getURL("src/options/options.html")),e&&e(),chrome.runtime.sendMessage({type:"refreshMoods"})}))}))})):(console.log("No active mood to deactivate!"),e&&e())}))})),chrome.runtime.onMessage.addListener((function(e){"refreshMoods"===e.type&&y()})),s.addEventListener("click",(function(){c.style.display="none",u.classList.remove("error"),m.style.display="none"})),window.addEventListener("click",(function(e){e.target===c&&(c.style.display="none",u.classList.remove("error"),m.style.display="none")})),r.addEventListener("submit",(function(e){e.preventDefault();var o=a.value,n=d.value,i=l.value,s=i;i&&!/^https?:\/\//i.test(i)&&(s="https://"+i);var r,u,m,f,v,g={id:o||(new Date).getTime().toString(),name:n,tabs:p,music:s};null!==h?(r=h,u=g.name,m=g.tabs.join(","),f=g.music,v=function(){y(),c.style.display="none"},chrome.storage.local.get("moods",(function(e){var o=e.moods||[];if(o&&o[r]){var n=m.split(",").map((function(e){return e=e.trim(),/^https?:\/\//i.test(e)||(e="https://"+e),e})),i=f;f&&!/^https?:\/\//i.test(f)&&(i="https://"+f),o[r]={name:u,tabs:n,music:i},chrome.storage.local.set({moods:o},(function(){t("Mood Updated","".concat(u," mood updated!"),chrome.runtime.getURL("src/options/options.html")),v&&v(),chrome.runtime.sendMessage({type:"refreshMoods"})}))}else console.error("Moods array is undefined or index is out of bounds")}))):chrome.storage.local.get({moods:[]},(function(e){var t=e.moods||[];t.push(g),chrome.storage.local.set({moods:t},(function(){chrome.runtime.sendMessage({type:"showNotification",title:"Mood Saved",message:"".concat(n," mood has been saved successfully!"),url:chrome.runtime.getURL("src/options/options.html")}),c.style.display="none",y()}))}))})),f.addEventListener("click",(function(){var e=u.value.trim();e&&function(e){return new RegExp("^(https?:\\/\\/)?(([a-zA-Z\\d]([a-zA-Z\\d-]*[a-zA-Z\\d])*)\\.?)+\\.[a-zA-Z]{2,}(\\:\\d+)?(\\/[-a-zA-Z\\d%_.~+]*)*(\\?[;&a-zA-Z\\d%_.~+=-]*)?(\\#[-a-zA-Z\\d_]*)?$","i").test(e)}(e)?(u.classList.remove("error"),m.style.display="none",/^https?:\/\//i.test(e)?p.push(e):p.push("https://"+e),o(p,v),u.value=""):(u.classList.add("error"),m.style.display="block",u.focus())})),u.addEventListener("input",(function(){"block"===m.style.display&&(u.classList.remove("error"),m.style.display="none")})),v.addEventListener("click",(function(e){!function(e,t,n){var i=e.target,c=i.getAttribute("data-index");if(i.classList.contains("edit-button")){var s=prompt("Edit URL:",t[c]);s&&(t[c]=s,o(t,n))}else i.classList.contains("delete-button")&&(t.splice(c,1),o(t,n))}(e,p,v)}))}))})();